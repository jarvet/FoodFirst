<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="zxx">
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="robots" content="index,follow">

    <title>Listing Hub - Listing & Directory Template | ThemezHub</title>

    <!-- Bootstrap Core CSS -->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
	
	<!-- Bootstrap Select Option css -->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap-select.min.css">
	
    <!-- Icons -->
    <link href="assets/plugins/font-awesome/css/font-awesome.css" rel="stylesheet">
	<link href="assets/plugins/themify-icons/css/themify-icons.css" rel="stylesheet">
	<link href="assets/plugins/line-icons/css/line-font.css" rel="stylesheet">
    
    <!-- Animate -->
    <link href="assets/plugins/animate/animate.css" rel="stylesheet">
    
    <!-- Bootsnav -->
    <link href="assets/plugins/bootstrap/css/bootsnav.css" rel="stylesheet">	
    
    <!-- Custom style -->
    <link href="assets/css/style.css" rel="stylesheet">
	<link href="assets/css/responsiveness.css" rel="stylesheet">
	<link href="assets/css/colors/main.css" rel="stylesheet">
	
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
    
	</head>
	<body>
		<div class="wrapper">  
			<!-- Start Navigation -->
			<nav class="navbar navbar-default navbar-fixed navbar-transparent white bootsnav">
				<div class="container-fluid">            
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
						<i class="ti-align-left"></i>
					</button>
					
					<!-- Start Header Navigation -->
					<div class="navbar-header">
						<a class="navbar-brand" href="index.html">
<!--							<img src="assets/img/logo.png" class="logo logo-display" alt="">
							<img src="assets/img/logo.png" class="logo logo-scrolled" alt="">-->
                                                    <h2>Food First</h2>
                                                </a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse" id="navbar-menu">
						<ul class="nav navbar-nav navbar-center" data-in="fadeInDown" data-out="fadeOutUp">

						</ul>
						<ul class="nav navbar-nav navbar-right" data-in="fadeInDown" data-out="fadeOutUp">
							<li class="no-pd"><a href="https://foodfirst.auth.us-east-1.amazoncognito.com/signup?redirect_uri=https://s3.amazonaws.com/ccassignment-yzz/chatnew.html&response_type=code&client_id=7ush532ifiupqf344ls4vn1tme" class="addlist"><i class="ti-user" aria-hidden="true"></i>Sign Up</a></li>
						</ul>
					</div>
					<!-- /.navbar-collapse -->
				</div>   
			</nav>
			<!-- End Navigation -->
                        <div class="clearfix">

                        </div>
			
			<!-- Start Login Section -->
			<section class="log-wrapper">
				<div class="container">
					<div class="col-md-6 col-sm-10 col-md-offset-3 col-sm-offset-1">
						<div class="log-box">
							<h2>Welcome <span class="theme-cl">Back!</span></h2>
							<form>
								<div class="input-group">
									<span class="input-group-addon"><i class="fa fa-envelope theme-cl"></i></span>
									<input id="username" type="text" class="form-control" placeholder="User Name">
								</div>
								<div class="input-group">
									<span class="input-group-addon"><i class="fa fa-lock theme-cl"></i></span>
									<input id="userpassword" type="password" class="form-control" placeholder="Password">
								</div>
								<div class="text-center">
                                                                    <button type="button" class="btn theme-btn width-200 btn-radius"><a href="#" onclick="login()">Enter</a></button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</section>
			<!-- End Login Section -->

			<!-- ================ Start Footer ======================= -->

			<!-- ================ End Footer Section ======================= -->
			
			<!-- ================== Login & Sign Up Window ================== -->

			<!-- ===================== End Login & Sign Up Window =========================== -->
			
			<a id="back2Top" class="theme-bg" title="Back to top" href="#"><i class="ti-arrow-up"></i></a>
			
			<!-- START JAVASCRIPT -->
			<!-- Jquery js-->
			<script src="assets/js/jquery.min.js"></script>
			
			<!-- Bootstrap js-->
			<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
			
			<!-- Bootsnav js-->
			<script src="assets/plugins/bootstrap/js/bootsnav.js"></script>
			<script src="assets/js/viewportchecker.js"></script>
			
			<!-- Slick Slider js-->
			<script src="assets/plugins/slick-slider/slick.js"></script>
			
			<!-- counter js-->
			<script src="assets/plugins/jquery-counter/js/waypoints.min.js"></script>
            <script src="assets/plugins/jquery-counter/js/jquery.counterup.min.js"></script>
			
			<!-- Custom Js -->
			<script src="assets/js/custom.js"></script>
                        <script type="text/javascript" src="lib/axios/dist/axios.standalone.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/rollups/hmac-sha256.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/rollups/sha256.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/components/hmac.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/components/enc-base64.js"></script>
                        <script type="text/javascript" src="lib/url-template/url-template.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/sigV4Client.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/apiGatewayClient.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/simpleHttpClient.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/utils.js"></script>
                        <script type="text/javascript" src="aws-sdk.js"></script>
                        <script type="text/javascript" src="apigClient.js"></script>
                        <script type="text/javascript" src="amazon-cognito-identity.min.js"></script>
                        <script type="text/javascript">

                          var accesskey;
                          var secretkey;
                          
                          
                        function setCookie(c_name,value,expiredays){
                            var exdate=new Date()
                            exdate.setDate(exdate.getDate()+expiredays)
                            document.cookie=c_name+ "=" +escape(value)+
                            ((expiredays==null) ? "" : ";expires="+exdate.toGMTString())
                        }                        
                        function getCookie(c_name)
                        {
                        if (document.cookie.length>0)
                          {
                          c_start=document.cookie.indexOf(c_name + "=")
                          if (c_start!=-1)
                            { 
                            c_start=c_start + c_name.length+1 
                            c_end=document.cookie.indexOf(";",c_start)
                            if (c_end==-1) c_end=document.cookie.length
                            return unescape(document.cookie.substring(c_start,c_end))
                            } 
                          }
                        return ""
                        }
                          function login(){
                              var username = document.getElementById("username").value;
                              var password = document.getElementById("userpassword").value;
                              console.log("username:"+username);
                              console.log("password:"+password);
                              //AWS.config.credentials.clear();
                              authentification(username,password);
                              //showkeys();
                              
                          }
                         function authentification(username,password){
                             
                               console.log("auth start");
                               var authenticationData = {
                                   Username : username,
                                   Password : password,
                               };
                               console.log(authenticationData);
                               var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
                               var poolData = { UserPoolId : 'us-east-1_1Ve02giXT',
                                   ClientId : '7ush532ifiupqf344ls4vn1tme'
                               };
                               var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
                               var userData = {
                                   Username :username,
                                   Pool : userPool
                               };
                               var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
                               cognitoUser.authenticateUser(authenticationDetails, {
                                   onSuccess: function (result) {
                                       console.log("auth success");
                                       var idtoken = result.idToken.jwtToken;   
                                       console.log(idtoken);
                                           //AWS.config.credentials.clear();
                                           AWS.config.region='us-east-1';
                                           AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                                               IdentityPoolId :'us-east-1:997a39b8-e480-4c6b-9f27-c3be9e7781aa',
                                               Logins : {
                                                   'cognito-idp.us-east-1.amazonaws.com/us-east-1_1Ve02giXT':idtoken
                                               }
                                           });
                                        AWS.config.credentials.refresh(function(){
                                           AWS.config.credentials.get(function(err) {
                                            if (err) throw err;
                                            accesskey = AWS.config.credentials.data.Credentials.AccessKeyId;
                                            secretkey = AWS.config.credentials.data.Credentials.SecretKey;
                                            sessiontoken = AWS.config.credentials.data.Credentials.SessionToken;
                                            
                                            console.log("username:"+username);
                                            console.log("accesskey:"+accesskey);
                                            console.log("secretkey:"+secretkey);
                                            console.log("sessiontoken:"+sessiontoken);
                                            
                                            setCookie("username",username,365);
                                            setCookie("accesskey",accesskey,365);
                                            setCookie("secretkey",secretkey,365);
                                            setCookie("sessiontoken",sessiontoken,365);
                                            
                                            window.location.href="search-listing.html";
                                            
                                          });
                                      });
                                           console.log("AWS.config.credentials");

                                   },
                                   onFailure: function(err) {
                                       console.log("fail");
                                       alert("logfail");
                                       location.reload();
                                       console.log(err);
                                       
                                   }

                               });
                               console.log("end cred"); 
    
                         }
                        </script>
			
			
		</div>
	</body>
</html>