<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="zxx">
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="robots" content="index,follow">

    <title>Listing Hub - Listing & Directory Template | ThemezHub</title>

    <!-- Bootstrap Core CSS -->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
	
	<!-- Bootstrap Select Option css -->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap-select.min.css">
	
	<!-- Choosen -->
    <link href="assets/plugins/bootstrap-choosen/css/bootstrap-chosen.css" rel="stylesheet">
	
    <!-- Icons -->
    <link href="assets/plugins/font-awesome/css/font-awesome.css" rel="stylesheet">
	<link href="assets/plugins/themify-icons/css/themify-icons.css" rel="stylesheet">
	<link href="assets/plugins/line-icons/css/line-font.css" rel="stylesheet">
    
    <!-- Animate -->
    <link href="assets/plugins/animate/animate.css" rel="stylesheet">
    
    <!-- Bootsnav -->
    <link href="assets/plugins/bootstrap/css/bootsnav.css" rel="stylesheet">
	
	<!-- DateDropper -->
    <link href="assets/plugins/date-dropper/datedropper.css" rel="stylesheet">
    
    <!-- Custom style -->
    <link href="assets/css/style.css" rel="stylesheet">
	<link href="assets/css/responsiveness.css" rel="stylesheet">
	<link href="assets/css/colors/main.css" rel="stylesheet">
	

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
    
	</head>
	<body class="home-2">
		<div class="wrapper">  
			<!-- Start Navigation -->
			<nav class="navbar navbar-default navbar-fixed navbar-transparent white bootsnav">
				<div class="container-fluid">            
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
						<i class="ti-align-left"></i>
					</button>
					
					<!-- Start Header Navigation -->
					<div class="navbar-header">
						<a class="navbar-brand" href="search-listing.html">
							<img src="assets/img/logo-white.png" class="logo logo-display" alt="">
							<img src="assets/img/logo.png" class="logo logo-scrolled" alt="">
						</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse" id="navbar-menu">
						<ul class="nav navbar-nav navbar-center" data-in="fadeInDown" data-out="fadeOutUp">
						</ul>
						<ul class="nav navbar-nav navbar-right" data-in="fadeInDown" data-out="fadeOutUp">
						</ul>
					</div>
					<!-- /.navbar-collapse -->
				</div>   
			</nav>
			<!-- End Navigation -->
			<div class="clearfix"></div>
			
			
			<!-- ================ Start Page Title ======================= -->
			<section class="title-transparent page-title" style="background:url(assets/img/userbackground.jpg);">
				<div class="container">
				</div>
			</section>
			<div class="clearfix"></div>
			<!-- ================ End Page Title ======================= -->
			
			<!-- ================ Edit Section Start ======================= -->
			<section class="padd-0">
				<div class="container">
					<div class="col-md-10 translateY-60 col-sm-12 col-md-offset-1">
						<!-- General Information -->
						<div class="add-listing-box edit-info mrg-bot-25 padd-bot-30 padd-top-25">
							<div class="listing-box-header">
								<h3 id="titleuser"></h3>
							</div>
							<form>
								<div class="row mrg-r-10 mrg-l-10">
									<div class="col-sm-6">
										<label>Name</label>
										<input type="text" id="myname" class="form-control" value="Not set yet,please update.">
									</div>
									<div class="col-sm-6">
										<label>Email</label>
										<input type="text" id ="myemail" class="form-control" value="Not set yet,please update.">
									</div>
									<div class="col-sm-6">
										<label>Phone</label>
										<input type="text" id="myphone" class="form-control" value="Not set yet,please update.">
									</div>
								</div>
							</form>
						</div>
						<!-- End General Information -->
						
						<!-- Edit Location -->
						<div class="add-listing-box add-location mrg-bot-25 padd-bot-30 padd-top-25">
							<div class="listing-box-header">
								<i class="ti-location-pin theme-cl"></i>
								<h3>Edit Location</h3>
								<p>Write Address Information about your listing Location</p>
							</div>
							<form>
								<div class="row mrg-r-10 mrg-l-10">
									<div class="col-sm-6">
										<label>Address</label>
										<input type="text" id="myaddress" class="form-control" value="Not set yet,please update.">
									</div>
									<div class="col-sm-6">
										<label>Zip-Code</label>
										<input id="myzipcode" type="text" class="form-control" value="Not set yet,please update.">
									</div>
								</div>
							</form>
						</div>
						<!-- End Edit Location -->
						
						<!-- Full Information -->
						<div class="add-listing-box full-detail mrg-bot-25 padd-bot-30 padd-top-25">
							<div class="listing-box-header">
								<i class="ti-write theme-cl"></i>
								<h3>Preference</h3>
								<p>Write Your Food Preference Here</p>
							</div>
							<form>
								<div id="preferlist" class="row mrg-r-10 mrg-l-10">									
								</div>
                                                                <div class="text-center">
                                                                            <a onclick="addPrefer()" class="btn theme-btn" title="Submit Listing">Add a slot</a>
                                                                </div>
							</form>
						</div>
						<!-- End Full Information -->
						
						<!-- Amenities Information -->

						<!-- End Amenities Information -->
						
						<!-- Bank Account Information -->

						<!-- End Bank Account Information -->						
						<!-- Change Password Information -->
<!--						<div class="add-listing-box opening-day mrg-bot-25 padd-bot-30 padd-top-25">
							<div class="listing-box-header">
								<i class="ti-lock theme-cl"></i>
								<h3>Change Password</h3>
								<p>Remember, Your Password should not be easy and common</p>
							</div>
							<form>
								<div class="row mrg-r-10 mrg-l-10">
									<div class="col-sm-6">
										<label>Old Password</label>
										<input type="text" class="form-control" value="*********">
									</div>
									
									<div class="col-sm-6">
										<label>New Password</label>
										<input type="text" class="form-control" value="*********">
									</div>
								</div>
							</form>
						</div>-->
						<!-- End Change Password Information -->
						<div class="text-center">
							<a onclick="updateUser()" class="btn theme-btn" title="Submit Listing">Update Profile</a>
						</div>
					</div>
				</div>
			</section>
			<!-- ================ End Edit Section Start ======================= -->
			
			
			<!-- ================ Start Footer ======================= -->

			<!-- ================ End Footer Section ======================= -->
			
			<!-- ================== Login & Sign Up Window ================== -->
   
			<!-- ===================== End Login & Sign Up Window =========================== -->
			
			<a id="back2Top" class="theme-bg" title="Back to top" href="#"><i class="ti-arrow-up"></i></a>
			

			
			<!-- START JAVASCRIPT -->
			<!-- Jquery js-->
			<script src="assets/js/jquery.min.js"></script>
			
			<!-- Bootstrap js-->
			<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
			
			<!-- Bootsnav js-->
			<script src="assets/plugins/bootstrap/js/bootsnav.js"></script>
			<script src="assets/js/viewportchecker.js"></script>
			
			<!-- Slick Slider js-->
			<script src="assets/plugins/slick-slider/slick.js"></script>
			
			<!-- bootstrap Select js-->
			<script src="assets/plugins/bootstrap-choosen/js/chosen.jquery.js"></script>
			
			<!-- counter js-->
			<script src="assets/plugins/jquery-counter/js/waypoints.min.js"></script>
                        <script src="assets/plugins/jquery-counter/js/jquery.counterup.min.js"></script>
			
			<!-- Datedropper js-->
			<script src="assets/plugins/date-dropper/datedropper.js"></script>
			
			<!-- Custom Js -->
			<script src="assets/js/custom.js"></script>
                        <script type="text/javascript" src="lib/axios/dist/axios.standalone.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/rollups/hmac-sha256.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/rollups/sha256.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/components/hmac.js"></script>
                        <script type="text/javascript" src="lib/CryptoJS/components/enc-base64.js"></script>
                        <script type="text/javascript" src="lib/url-template/url-template.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/sigV4Client.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/apiGatewayClient.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/simpleHttpClient.js"></script>
                        <script type="text/javascript" src="lib/apiGatewayCore/utils.js"></script>
                        <script type="text/javascript" src="aws-sdk.js"></script>
                        <script type="text/javascript" src="apigClient.js"></script>
			
			<!-- Date Dropper -->			
				$('.datedropper').dateDropper();
			</script>
			<!-- load user -->
                        <script>
                        
                        const Maxprefer =6;
                        var current =0;    
                        //var username = "wz11311";
                        
                        var accesskey;
                        var secretkey;
                        var sessiontoken;
                        var username;
                        var apigClient;
                        
                        mainget();
                        mainload();
                        function mainget(){
                            console.log("test log");
                            accesskey=getCookie("accesskey");
                            secretkey = getCookie("secretkey");
                            sessiontoken = getCookie("sessiontoken");
                            username = getCookie("username");
                            
//                            console.log("username:"+username);
//                            console.log("accesskey:"+accesskey);
//                            console.log("secretkey:"+secretkey);
//                            console.log("sessiontoken:"+sessiontoken);
                            console.log("Apigateway Athuentication Success");
                            apigClient = apigClientFactory.newClient(
                            {
                                accessKey: accesskey,
                                secretKey: secretkey,
                                sessionToken: sessiontoken,
                                region:'us-east-1'
                             }        
                            );   
                            
                        }
                        
                        function setCookie(c_name,value,expiredays){
                            var exdate=new Date()
                            exdate.setDate(exdate.getDate()+expiredays)
                            document.cookie=c_name+ "=" +escape(value)+
                            ((expiredays==null) ? "" : ";expires="+exdate.toGMTString())
                        }
                        
                        
                        function getCookie(c_name)
                            {
                            if (document.cookie.length>0)
                              {
                              c_start=document.cookie.indexOf(c_name + "=")
                              if (c_start!=-1)
                                { 
                                c_start=c_start + c_name.length+1 
                                c_end=document.cookie.indexOf(";",c_start)
                                if (c_end==-1) c_end=document.cookie.length
                                return unescape(document.cookie.substring(c_start,c_end))
                                } 
                              }
                            return ""
                        }
                        
                        
                        function getprefer(){
                            console.log("getprefer");
                            var preferlist=[];
                            var selects =document.getElementsByName("prefer");
                            console.log(selects.length);                           
                            for(var i=0;i<selects.length;i++){
                                    console.log(selects[i].value); 
                                    preferlist.push(selects[i].value);
                            }
                            console.log(preferlist);
                            console.log("end getprefer");
                            return preferlist;
                        }
                        
                        function getpreferStr(){
                            console.log("getprefer");
                            var preferlist="";
                            var separator =",";
                            var selects =document.getElementsByName("prefer");
                            console.log(selects);
                            if(selects.length==0){
                                return "";
                            }
                            var preferlist=selects[0].value;
                            //console.log(selects.length);                           
                            for(var i=1;i<selects.length;i++){
                                    console.log(selects[i].value); 
                                    preferlist = preferlist+separator+selects[i].value;
                            }
                            console.log(preferlist);
                            console.log("end getprefer");
                            return preferlist;
                        }
                        
                        function loadpreferinput(size){
                            for(var i =0;i<size;i++){
                                addPrefer();     
                            }
                            
                        }
                        
                        
                        function loadUser(myuser){
                            console.log("load user");
                            document.getElementById('titleuser').innerHTML=username;                          
                            var pre = myuser.prefer;
                            var size = pre.length;
                            
                            var additionalsize = size-current;
                            console.log("currentsize:"+current);
                            console.log("current:"+current);
                            console.log("additionalsize:"+additionalsize);
                            
                            loadpreferinput(additionalsize);
                            document.getElementById("myname").value = myuser.fullname;
                            document.getElementById("myemail").value = myuser.email;
                            document.getElementById("myphone").value = myuser.phone;
                            document.getElementById("myaddress").value = myuser.address;
                            document.getElementById("myzipcode").value = myuser.zip;
                            console.log("size:"+size);
                            console.log(pre);
                            var allprefer =document.getElementsByName("prefer");
                            for(var i=0;i<allprefer.length;i++){
                                    allprefer[i].value = pre[i];
                            }                          
                            console.log("load finish");
                        }
                        function addPrefer(){
                            console.log(current);
                            console.log(Maxprefer);
                                if(current<Maxprefer){
                                 index= current+1;
                                 list='<div class="col-sm-6">'
                                 +'<label>Prefer Cusine <a href="#" class="removeclass">×</a></label>'
                                 +'<input name="prefer" id="cusine'+index+'" type="text" class="form-control">'
                                 +'</div>';
                 										
                                 $('#preferlist').append(list);
                                 current=index;
                                 
                             }  
                            
                        }
                        $("body").on("click", ".removeclass", function (e) { //user click on remove text
                                console.log("remove"); 
                                $(this).parent('label').parent('div').remove(); 
                                 console.log("remove2"); 
                                 current=current-1;
                                 return false;
                        })     
                        function updateUser(){
                             console.log("updateuser");
                             var myname = document.getElementById("myname").value;
                             var myemail = document.getElementById("myemail").value;
                             var myphone = document.getElementById("myphone").value;
                              
                             var myaddress = document.getElementById("myaddress").value;
                             var myzip =document.getElementById("myzipcode").value;

                            var list=getpreferStr();
              
                            
//                            var updateduser = {
//                                username:myname,
//                                fullname:myname,
//                                prefer:list, 
//                                email:myemail,
//                                phone:myphone,
//                                address:myaddress,
//                                zip:myzip
//                                                      
//                            };
                            
                            var params = {
                                };
                            var userbody = {
                              // This is where you define the body of the request,
                              messages:[{
                                          type:"update",
                                          unstructured:{
                                          username:username,
                                          fullname:myname,
                                          prefer:list,
                                          email:myemail,
                                          phone:myphone,
                                          address:myaddress,
                                          zip:myzip
                                        }
                                       }]
                            };     
                            console.log(userbody);
                            //apigClient = apigClientFactory.newClient();      
                            apigClient.ccprojectuserPost(params, userbody, {})
                            .then(function(response){
                              // Add success callback code here.
                                console.log("usertest");
                                console.log(response.data.messages[0].unstructured);
                                loadUser(response.data.messages[0].unstructured);
                            }).catch( function(error){
                              console.log(error);
                            }); 

                            console.log("updateuser end");
                              
                        }
                        //loadUser(user);
                        
                        function mainload(){
                            //var username = "smanya"
//                        　　var accesskey=getCookie("accesskey");
//                            var secretkey = getCookie("secretkey");
//                            var sessiontoken = getCookie("sessiontoken");
                            //var username = "wz11311";
                            var params = {
                                };
                            var userbody = {
                              // This is where you define the body of the request,
                              messages:[{
                                          type:"get",
                                          unstructured:{
                                          username:username,
                                          fullname:'',
                                          prefer:'',
                                          email:'',
                                          phone:'',
                                          address:'',
                                          zip:''
                                        }
                                       }]
                            };     
                            //apigClient = apigClientFactory.newClient();      
                            apigClient.ccprojectuserPost(params, userbody, {})
                            .then(function(response){
                              // Add success callback code here.
                                console.log("usertest");
                                console.log(response.data.messages[0].unstructured);
                                loadUser(response.data.messages[0].unstructured);
                            }).catch( function(error){
                              console.log(error);
                            }); 
                        }
                        
                        function testgetuser(){
                            console.log("testgetuser");
                            var username = "wz11311";
                            var params = {
                                };
                            var userbody = {
                              // This is where you define the body of the request,
                              messages:[{
                                          type:"get",
                                          unstructured:{
                                          username:username,
                                          fullname:'',
                                          prefer:'',
                                          email:'',
                                          phone:'',
                                          address:'',
                                          zip:''
                                        }
                                       }]
                            };     
                            apigClient = apigClientFactory.newClient();      
                            apigClient.ccprojectuserPost(params, userbody, {})
                            .then(function(response){
                              // Add success callback code here.

                                console.log("getusertest");
                                console.log(response.data.messages[0].unstructured);
                                //loadUser(response);
                            }).catch( function(error){
                              console.log(error);
                            });
                            console.log("testgetuser end");
                        }
                        </script>

                        
                        <!-- load user end -->
			<!-- Bootstrap Choosen Script -->
			<script>
			  $(function() {
				$('.chosen-select').chosen();
				$('.chosen-select-deselect').chosen({ allow_single_deselect: true });
			  });                       

                         // test();
			</script>
		</div>
	</body>
</html>